{% extends "base.html" %}

{% block content %}
<div dir="rtl" class="min-h-screen flex items-center justify-center bg-gray-100 p-8">

  <form id="register-form" onsubmit="register(event)" class="bg-white p-8 rounded shadow-md w-full max-w-md space-y-4">
    <h2 class="text-2xl font-bold text-center">تسجيل حساب جديد</h2>
    <div>
      <label for="username" class="block mb-1">اسم المستخدم:</label>
      <input dir="auto" name="username" id="username" type="text" class="w-full border rounded px-3 py-2" required />
    </div>

    <div>
      <label for="first_name" class="block mb-1">الاسم الأول:</label>
      <input dir="auto" name="first_name" id="first_name" type="text" class="w-full border rounded px-3 py-2"
        required />
    </div>

    <div>
      <label for="last_name" class="block mb-1">الاسم الأخير:</label>
      <input dir="auto" name="last_name" id="last_name" type="text" class="w-full border rounded px-3 py-2" required />
    </div>

    <div>
      <label for="email" class="block mb-1">البريد الإلكتروني:</label>
      <input dir="auto" name="email" id="email" type="email" class="w-full border rounded px-3 py-2" required />
    </div>

    <div>
      <label for="password" class="block mb-1">كلمة المرور:</label>
      <input dir="auto" name="password" id="password" type="password" class="w-full border rounded px-3 py-2"
        required />
    </div>

    <div>
      <label for="confirm_password" class="block mb-1">تأكيد كلمة المرور:</label>
      <input dir="auto" name="confirm_password" id="confirm_password" type="password"
        class="w-full border rounded px-3 py-2" required />
    </div>

    <button type="submit" class="w-full bg-green-600 hover:bg-blue-700 text-white py-2 rounded">تسجيل</button>

    <p class="text-sm text-center mt-2">هل لديك حساب؟ <a href="/login" class="text-blue-600 hover:underline">تسجيل
        الدخول</a></p>
  </form>

</div>

<script>
  function register(event) {
    event.preventDefault();
    const formData = new FormData(document.getElementById('register-form'));

    const data = {
      username: formData.get('username'),
      first_name: formData.get('first_name'),
      last_name: formData.get('last_name'),
      email: formData.get('email'),
      password: formData.get('password'),
    };

    if (data.password !== formData.get('confirm_password')) {
      alert("كلمات المرور غير متطابقة!");
      return;
    }

    fetch('/api/users', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(data),
    })
      .then(response => {
        if (response.status === 200) {
          alert('تم إنشاء الحساب بنجاح');
          window.location.href = '/login';
        } else if (response.status === 400) {
          alert("التسجيل غير مسموح");
        } else {
          response.json().then(response => {
            alert(response.message || "حدث خطأ أثناء التسجيل.");
          });
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('حدث خطأ يرجى المحاولة في وقت لاحق.');
      });
  }
</script>
{% endblock %}