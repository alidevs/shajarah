{% extends "base.html" %}

{% block content %}
<div dir="rtl" class="min-h-screen flex items-center justify-center bg-gray-100 p-6">
  <form onsubmit="submitLogin(event)" class="bg-white p-8 rounded shadow-md w-full max-w-md space-y-4">
    <h2 class="text-2xl font-bold text-center">تسجيل الدخول</h2>

    <div>
      <label class="block mb-1">البريد الإلكتروني:</label>
      <input dir="auto" name="email" type="email" required class="w-full border rounded px-3 py-2" />
    </div>

    <div>
      <label class="block mb-1">الكلمة المؤقتة (TOTP):</label>
      <input dir="auto" name="totp" type="password" required class="w-full border rounded px-3 py-2" />
    </div>

    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded">تسجيل الدخول</button>
  </form>
</div>

<script>
  async function submitLogin(event) {
    event.preventDefault();
    const form = event.target;
    const data = Object.fromEntries(new FormData(form).entries());

    const response = await fetch("/api/users/login", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(data)
    });

    if (response.ok) {
      window.location.href = "/user";
    } else {
      alert("فشل تسجيل الدخول");
    }
  }
</script>
{% endblock %}